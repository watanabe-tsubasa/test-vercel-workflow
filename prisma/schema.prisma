// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String?  @unique
  image     String?
  diaries   Diary[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Diary {
  id          String   @id @default(cuid())
  title       String
  date        DateTime
  content     String?
  imageUrl    String?
  hasImage    Boolean  @default(false)
  state       DiaryState @default(DRAFT) // 作成状態を管理
  workflowId  String?  @unique           // Workflowとの対応
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum DiaryState {
  DRAFT        // 箇条書き入力後
  GENERATING   // AIが日記文を生成中
  WAITING_USER // ユーザー修正版待ち
  DRAWING      // 画像生成中
  COMPLETED    // 完了
}
